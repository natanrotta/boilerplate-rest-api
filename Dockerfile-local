FROM node:18-alpine

WORKDIR /usr/src/app

# Instala dependências de build
RUN apk add --no-cache python3 make g++

# Instala o ts-node globalmente para desenvolvimento
RUN yarn global add ts-node typescript nodemon

# Copia os arquivos de definição de dependências
COPY package.json yarn.lock ./

# Instala as dependências
RUN yarn install --frozen-lockfile

# Copia os arquivos do projeto
COPY . .

# ✅ Gera o Prisma Client (importante!)
RUN yarn prisma generate

# Porta configurável via env
EXPOSE ${API_PORT}

# Comando padrão (sobrescrito no docker-compose)
CMD ["yarn", "dev"]
